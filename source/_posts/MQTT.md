---
title: MQTT
date: 2024-08-20 18:30:38
tags:
  - MQTT
categories:	
  - Embedded
description: MQTT

---

# MQTT

MQTT（Message Queuing Telemetry Transport）是一种轻量级的发布/订阅消息传输协议，设计用于低带宽、不稳定或高延迟的网络环境。它特别适合物联网（IoT）设备的通信。MQTT通过其简单的架构和低开销，使其在资源受限的设备之间进行消息传递成为理想选择。

### 一、MQTT的基本概念

1. **发布/订阅模型**：
   - **发布者**：向某个主题（Topic）发送消息的设备或应用程序。
   - **订阅者**：订阅某个主题以接收消息的设备或应用程序。
   - **主题（Topic）**：消息的类别或通道。它是一种分层的路径结构，用于消息的分类和过滤。
   - **消息代理（Broker）**：负责接收发布者的消息，并将它们发送给所有订阅该消息主题的订阅者。

   这种模型解耦了消息发送者和接收者，发布者和订阅者并不直接通信，而是通过消息代理中介通信。

2. **消息的质量等级（QoS）**：
   MQTT提供了三种消息传递的服务质量（QoS）等级，以确保消息的可靠传输：
   - **QoS 0**：消息发送时不保证到达，可能会丢失。称为“尽力而为”。
   - **QoS 1**：消息至少到达一次。消息可能会重复接收。
   - **QoS 2**：消息确保到达一次且仅到达一次，保证最严格的消息传输。

3. **保留消息**：
   发布者可以发送一条保留消息，该消息会一直保存在代理中，当新的订阅者订阅该主题时，立即收到这条保留消息。

4. **遗嘱消息**：
   设备可以在连接断开时，由Broker发布一条消息通知其他设备。这在监控设备状态的应用场景中非常有用。

### 二、MQTT的工作流程

1. **客户端连接到Broker**：发布者和订阅者首先要通过TCP连接到MQTT Broker。连接时，客户端需要发送一个连接请求包，包括客户端ID、用户名、密码等信息。

2. **发布消息**：发布者向Broker发送特定主题的消息。Broker收到消息后，将其转发给所有订阅了该主题的订阅者。

3. **订阅主题**：订阅者向Broker发送订阅请求，表示对某一主题的兴趣。订阅者可以订阅多个主题。

4. **接收消息**：Broker将发布者发送的消息分发给订阅该主题的所有订阅者。

5. **保持连接**：为了保持连接，客户端会定期发送心跳消息（PINGREQ）以确认连接的有效性，Broker也会响应（PINGRESP）。

### 三、MQTT的优势

1. **轻量级**：MQTT的协议头非常小，开销低，适合低带宽和不稳定的网络。
2. **实时性强**：由于发布/订阅模型，消息可以及时推送给订阅者，适合实时性要求高的场景。
3. **可靠性**：通过QoS机制，用户可以根据应用需求选择不同的消息传递质量，确保可靠性。
4. **灵活性**：发布者和订阅者之间的解耦使得系统更加灵活，不同设备可以在不同时间发布和接收消息。

### 四、MQTT应用场景

1. **物联网（IoT）**：传感器、智能家居、远程监控等场景中，设备之间的通信常常通过MQTT来完成。
2. **远程控制**：比如远程灯光控制、家用电器控制等，利用MQTT可以快速实现设备之间的消息通信。
3. **实时数据流**：金融市场的实时数据发布、交通监控、社交媒体信息推送等。

### 五、MQTT和嵌入式系统

在嵌入式系统中，MQTT常用于：
- **传感器节点**：传感器将采集到的数据通过MQTT发布到云端或本地服务器，其他设备可以订阅这些数据，做出相应响应。
- **远程监控系统**：比如工厂设备、工业物联网应用，可以通过MQTT监控设备状态，并接收异常情况通知。
- **低功耗设备**：MQTT协议非常适合电池供电的低功耗设备，因为它的传输协议头小，连接时间短，适合节能需求。

### 六、MQTT的实现

1. **常见的MQTT Broker**：
   - **Mosquitto**：一个开源的MQTT Broker，支持QoS等级、持久化、身份验证等特性。
   - **EMQX**：一款支持高并发的MQTT Broker，具备高性能、分布式集群能力。
   - **HiveMQ**：主要用于企业级的MQTT Broker，支持企业级应用场景中的扩展性和高可用性。

2. **嵌入式MQTT库**：
   - **Paho MQTT**：Eclipse提供的开源MQTT库，支持多种编程语言。
   - **uMQTT**：适合在内存和资源受限的嵌入式设备上使用的轻量级MQTT库。

MQTT在嵌入式系统中的广泛应用，使得物联网设备之间的通信更加高效、灵活。